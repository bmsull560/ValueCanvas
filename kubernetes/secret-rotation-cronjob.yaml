apiVersion: batch/v1
kind: CronJob
metadata:
  name: secret-rotation
  namespace: valuecanvas
spec:
  schedule: "0 4 * * *"
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          serviceAccountName: audit-ops
          containers:
            - name: rotate-secrets
              image: valuecanvas/api:latest
              imagePullPolicy: IfNotPresent
              command: ["node", "dist/scripts/run-secret-rotation.js"]
              env:
                - name: ROTATION_TENANT_ID
                  value: "shared"
                - name: ROTATION_SECRET_KEY
                  value: "database/password"
                - name: ROTATION_TARGET_WEBHOOK
                  valueFrom:
                    secretKeyRef:
                      name: rotation-webhook
                      key: url
                - name: SECRETS_PROVIDER
                  value: "aws"
                - name: AWS_REGION
                  value: "us-east-1"
                - name: CACHE_ENCRYPTION_KEY
                  valueFrom:
                    secretKeyRef:
                      name: valuecanvas-secrets
                      key: cacheEncryptionKey
